<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PropeloKit - AI Tools Dashboard</title>
    
    <!-- FirebaseUI CSS -->
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.css" />

    <!-- Tailwind CSS & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Custom Styles -->
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #4a4a4a; border-radius: 4px; }
        .propel-accent { color: #00A9FF; }
        .propel-button { background-color: #00A9FF; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .propel-button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(0, 169, 255, 0.4); }
        .propel-button:disabled { background-color: #005f8e; cursor: not-allowed; }
        .propel-gradient-text { background: linear-gradient(90deg, #00A9FF, #A0E9FF); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .glass-card { background: rgba(26, 26, 26, 0.6); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .page { animation: slideIn 0.5s forwards; opacity: 0; }
        @keyframes slideIn { from { transform: translateX(20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        /* Typing cursor for streaming */
        .typing-cursor::after { content: 'â–‹'; animation: blink 1s step-end infinite; }
        @keyframes blink { 50% { opacity: 0; } }
        /* FirebaseUI Customization */
        .firebaseui-idp-button { background-color: #333 !important; }
        .firebaseui-title { color: white !important; }
        .firebaseui-label, .firebaseui-input-label { color: #ccc !important; }
        .firebaseui-input { background-color: #2d2d2d !important; color: white !important; border-color: #555 !important; }
        .firebaseui-link { color: #00A9FF !important; }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <!-- Auth Screen -->
    <div id="auth-screen" class="min-h-screen flex items-center justify-center bg-gray-900 p-4">
        <div class="w-full max-w-md text-center">
            <h1 class="text-5xl font-bold propel-gradient-text mb-2">PropeloKit</h1>
            <p class="text-gray-400 mb-8">The most advanced Firebase AI dashboard.</p>
            <div id="firebaseui-auth-container"></div>
            <p id="auth-error" class="text-red-400 mt-4"></p>
        </div>
    </div>
    
    <!-- Main Application -->
    <div id="app-shell" class="hidden min-h-screen flex">
        <nav class="w-20 bg-black/30 p-4 flex flex-col items-center space-y-8 border-r border-gray-800">
            <div class="propel-gradient-text font-black text-2xl">P</div>
            <div class="flex flex-col items-center space-y-6 text-gray-400">
                <button data-view="dashboard" class="nav-item p-3 rounded-lg bg-gray-700 text-white"><i data-lucide="layout-dashboard"></i></button>
                <button data-view="tools" class="nav-item p-3 rounded-lg hover:bg-gray-700/50 hover:text-white"><i data-lucide="cpu"></i></button>
            </div>
            <div class="flex-grow"></div>
            <div id="user-avatar" class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center text-white font-bold"></div>
        </nav>
        
        <main id="main-content" class="flex-1 p-8 overflow-y-auto">
            <!-- Content will be injected here -->
        </main>
    </div>

    <!-- Page Templates -->
    <template id="dashboard-template">
        <div class="page">
            <header class="flex justify-between items-center mb-8">
                <div>
                    <h1 class="text-3xl font-bold text-white">Propulsion Hub</h1>
                    <p class="text-gray-400">Welcome back, <span id="user-name">User</span>. Today is <span id="current-date"></span>.</p>
                </div>
                <button id="logout-btn" class="bg-gray-800 hover:bg-red-500/50 text-white font-semibold py-2 px-4 rounded-lg flex items-center gap-2 transition-colors">
                    <i data-lucide="log-out" class="w-4 h-4"></i> Logout
                </button>
            </header>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <section>
                    <h2 class="text-xl font-semibold mb-4 text-white">ðŸš€ Get Started</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="glass-card p-6 rounded-xl hover:border-blue-500/50 transition-all cursor-pointer" onclick="renderView('tools')">
                            <i data-lucide="cpu" class="propel-accent mb-2"></i>
                            <h3 class="font-semibold text-white">Explore AI Tools</h3>
                            <p class="text-sm text-gray-400">Access the full suite of AI models.</p>
                        </div>
                         <div class="glass-card p-6 rounded-xl hover:border-blue-500/50 transition-all">
                            <i data-lucide="settings" class="propel-accent mb-2"></i>
                            <h3 class="font-semibold text-white">Account Settings</h3>
                            <p class="text-sm text-gray-400">Manage your profile and preferences.</p>
                        </div>
                    </div>
                </section>
                <section>
                    <h2 class="text-xl font-semibold mb-4 text-white">âš¡ Recent Trajectories</h2>
                    <div id="trajectories-feed" class="space-y-3">
                        <p class="text-gray-500">No recent activity.</p>
                    </div>
                </section>
            </div>
        </div>
    </template>
    
    <template id="tools-template">
        <div class="page">
             <header class="mb-8">
                <h1 class="text-3xl font-bold text-white">Dynamic Workbench</h1>
                <p class="text-gray-400">Harness the power of <code class="bg-gray-700/50 px-1.5 py-1 rounded-md text-sm">gemini-2.5-pro</code>.</p>
            </header>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="tool-card glass-card rounded-2xl p-6 flex flex-col group" data-tool="summarizer">
                    <i data-lucide="file-text" class="propel-accent mb-4 w-8 h-8"></i>
                    <h3 class="font-semibold text-lg text-white mb-2">Streaming Summarizer</h3>
                    <p class="text-gray-400 text-sm mb-4 flex-grow">Condense text with real-time streaming and custom system instructions.</p>
                    <button class="w-full text-center bg-gray-700/80 hover:bg-blue-600/50 text-white font-semibold py-2 rounded-lg transition-all">Open</button>
                </div>
                <div class="tool-card glass-card rounded-2xl p-6 flex flex-col group" data-tool="researcher">
                    <i data-lucide="search" class="propel-accent mb-4 w-8 h-8"></i>
                    <h3 class="font-semibold text-lg text-white mb-2">AI Research Agent</h3>
                    <p class="text-gray-400 text-sm mb-4 flex-grow">Get answers to complex questions grounded in up-to-date Google Search results.</p>
                    <button class="w-full text-center bg-gray-700/80 hover:bg-blue-600/50 text-white font-semibold py-2 rounded-lg transition-all">Open</button>
                </div>
                <div class="tool-card glass-card rounded-2xl p-6 flex flex-col group" data-tool="ideas">
                    <i data-lucide="lightbulb" class="propel-accent mb-4 w-8 h-8"></i>
                    <h3 class="font-semibold text-lg text-white mb-2">Content Idea Generator</h3>
                    <p class="text-gray-400 text-sm mb-4 flex-grow">Generate structured content ideas (titles, descriptions) in a perfect JSON format.</p>
                    <button class="w-full text-center bg-gray-700/80 hover:bg-blue-600/50 text-white font-semibold py-2 rounded-lg transition-all">Open</button>
                </div>
            </div>
        </div>
    </template>
    
    <!-- TOOL: SUMMARIZER -->
    <template id="summarizer-tool-template">
        <div class="page h-full flex flex-col">
            <header class="mb-6"><h1 class="text-3xl font-bold text-white">Streaming Text Summarizer</h1></header>
            <div class="flex-grow grid grid-cols-1 lg:grid-cols-2 gap-6 h-full">
                <div class="flex flex-col gap-4">
                    <h2 class="text-lg font-semibold text-white">System Instruction (Optional)</h2>
                    <input id="summarizer-system" type="text" class="w-full bg-gray-800/50 border border-gray-700 rounded-lg py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Summarize for a 5th grader">
                    <h2 class="text-lg font-semibold text-white mt-2">Input Text</h2>
                    <textarea id="summarizer-input" class="flex-grow w-full bg-gray-800/50 border border-gray-700 rounded-lg p-3 text-gray-300 focus:outline-none resize-none" placeholder="Paste your long text here..."></textarea>
                    <button id="summarize-btn" class="propel-button w-full py-3 rounded-lg text-white font-bold flex items-center justify-center gap-2"><i data-lucide="wand-2"></i> Propel</button>
                </div>
                <div class="flex flex-col">
                    <h2 class="text-lg font-semibold text-white mb-3">Output (Streaming)</h2>
                    <div class="flex-grow glass-card rounded-2xl p-4 overflow-y-auto">
                        <p id="summarizer-output" class="text-gray-200 whitespace-pre-wrap"></p>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- TOOL: RESEARCHER -->
    <template id="researcher-tool-template">
        <div class="page h-full flex flex-col">
            <header class="mb-6"><h1 class="text-3xl font-bold text-white">AI Research Agent</h1></header>
            <div class="flex flex-col h-full">
                 <div class="flex-grow glass-card rounded-2xl p-4 flex flex-col justify-between">
                    <div id="researcher-output" class="overflow-y-auto space-y-4 text-gray-200">
                        <p class="text-gray-500">Ask a question to get a response grounded in Google Search.</p>
                    </div>
                    <div class="mt-4 flex gap-4">
                        <input id="researcher-input" type="text" class="flex-grow bg-gray-800/50 border border-gray-700 rounded-lg py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., What are the key AI trends in 2025?">
                        <button id="research-btn" class="propel-button px-6 py-2 rounded-lg text-white font-bold flex items-center justify-center gap-2"><i data-lucide="search"></i></button>
                    </div>
                 </div>
            </div>
        </div>
    </template>

    <!-- TOOL: IDEAS -->
    <template id="ideas-tool-template">
        <div class="page h-full flex flex-col">
            <header class="mb-6"><h1 class="text-3xl font-bold text-white">Content Idea Generator</h1></header>
             <div class="flex-grow grid grid-cols-1 lg:grid-cols-2 gap-6 h-full">
                <div class="flex flex-col gap-4">
                     <h2 class="text-lg font-semibold text-white">Topic</h2>
                     <input id="ideas-input" type="text" class="w-full bg-gray-800/50 border border-gray-700 rounded-lg py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Firebase AI">
                     <button id="ideas-btn" class="propel-button w-full py-3 rounded-lg text-white font-bold flex items-center justify-center gap-2"><i data-lucide="lightbulb"></i> Generate Ideas</button>
                </div>
                <div class="flex flex-col">
                     <h2 class="text-lg font-semibold text-white mb-3">Structured Output (JSON)</h2>
                     <div id="ideas-output" class="flex-grow glass-card rounded-2xl p-4 space-y-4 overflow-y-auto">
                        <p class="text-gray-500">Generated ideas will appear here.</p>
                     </div>
                </div>
             </div>
        </div>
    </template>
    
    <!-- FirebaseUI JS -->
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>

    <!-- Firebase Services Module -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js'
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, EmailAuthProvider, signOut } from 'https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js'
        import { getFirestore, doc, setDoc, collection, addDoc, query, orderBy, limit, onSnapshot } from 'https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js'
        import { getFunctions, httpsCallable } from 'https://www.gstatic.com/firebasejs/12.4.0/firebase-functions.js'
        
        // --- 1. PASTE YOUR FIREBASE CONFIGURATION HERE ---
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyDAulZh_MKMFLUtH3w74QEs2_nmrKZ-ZgU",
  authDomain: "propelokit.firebaseapp.com",
  databaseURL: "https://propelokit-default-rtdb.firebaseio.com",
  projectId: "propelokit",
  storageBucket: "propelokit.firebasestorage.app",
  messagingSenderId: "450333221931",
  appId: "1:450333221931:web:422f3be7a9772b8f61b66e",
  measurementId: "G-3Y831Y6EG0"
};
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const functions = getFunctions(app);

        // --- Global State ---
        let currentUser = null;
        let unsubscribeTrajectories = null;
        
        // --- Authentication with FirebaseUI ---
        const ui = new firebaseui.auth.AuthUI(auth);
        
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('app-shell').classList.remove('hidden');
                document.getElementById('app-shell').classList.add('flex');
                
                await setDoc(doc(db, "users", user.uid), {
                    displayName: user.displayName,
                    email: user.email,
                    photoURL: user.photoURL,
                }, { merge: true });

                updateUserInfo(user);
                window.renderView('dashboard');
            } else {
                currentUser = null;
                if (unsubscribeTrajectories) unsubscribeTrajectories();
                document.getElementById('auth-screen').classList.remove('hidden');
                document.getElementById('app-shell').classList.add('hidden');
                document.getElementById('app-shell').classList.remove('flex');
                ui.start('#firebaseui-auth-container', {
                    signInSuccessUrl: '#',
                    signInOptions: [
                        GoogleAuthProvider.PROVIDER_ID,
                        { provider: EmailAuthProvider.PROVIDER_ID, signInMethod: 'emailLink' }
                    ],
                });
            }
        });

        // --- UI & View Management ---
        window.renderView = (viewName) => {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = '';
            const template = document.getElementById(`${viewName}-tool-template`) || document.getElementById(`${viewName}-template`);
            if (template) {
                mainContent.appendChild(template.content.cloneNode(true));
                // Hook up view-specific listeners
                if (viewName === 'dashboard') setupDashboardListeners();
                if (viewName === 'tools') setupToolsListeners();
                if (viewName === 'summarizer') setupSummarizerListeners();
                if (viewName === 'researcher') setupResearcherListeners();
                if (viewName === 'ideas') setupIdeasListeners();
            }
            document.querySelectorAll('.nav-item').forEach(item => {
                const isToolsView = ['tools', 'summarizer', 'researcher', 'ideas'].includes(viewName);
                const targetView = isToolsView ? 'tools' : 'dashboard';
                item.classList.toggle('bg-gray-700', item.dataset.view === targetView);
                item.classList.toggle('text-white', item.dataset.view === targetView);
            });
            lucide.createIcons();
        };

        const updateUserInfo = (user) => {
             const userAvatar = document.getElementById('user-avatar');
             if(user.photoURL) {
                userAvatar.innerHTML = `<img src="${user.photoURL}" alt="User Avatar" class="w-full h-full rounded-full object-cover">`;
             } else {
                userAvatar.textContent = (user.displayName || user.email).charAt(0).toUpperCase();
             }
        };

        // --- Dashboard ---
        function setupDashboardListeners() {
            document.getElementById('user-name').textContent = currentUser.displayName || currentUser.email;
            const today = new Date();
            // Set date based on current location: Dhaka, Bangladesh
            document.getElementById('current-date').textContent = today.toLocaleDateString('en-US', { timeZone: 'Asia/Dhaka', weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('logout-btn').onclick = () => signOut(auth);
            
            const q = query(collection(db, "users", currentUser.uid, "trajectories"), orderBy("timestamp", "desc"), limit(5));
            unsubscribeTrajectories = onSnapshot(q, snapshot => {
                const feed = document.getElementById('trajectories-feed');
                if (snapshot.empty) {
                     feed.innerHTML = '<p class="text-gray-500">No recent activity.</p>';
                     return;
                }
                feed.innerHTML = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const icons = { Summarized: 'file-text', Researched: 'search', Ideated: 'lightbulb' };
                    feed.innerHTML += `<div class="glass-card p-3 rounded-lg flex items-center gap-3 text-sm">
                        <i data-lucide="${icons[data.action] || 'zap'}" class="propel-accent w-5 h-5"></i>
                        <div>
                           <span class="font-medium text-white">${data.action}:</span>
                           <span class="text-gray-300">"${data.title}"</span>
                        </div>
                    </div>`;
                });
                lucide.createIcons();
            });
        }
        
        // --- Tools Listeners ---
        function setupToolsListeners() {
            document.querySelectorAll('.tool-card').forEach(card => {
                card.addEventListener('click', () => renderView(card.dataset.tool));
            });
        }
        
        // --- AI TOOL: Summarizer (Streaming & System Instructions) ---
        function setupSummarizerListeners() {
            const summarizeBtn = document.getElementById('summarize-btn');
            summarizeBtn.onclick = async () => {
                const input = document.getElementById('summarizer-input').value;
                const system = document.getElementById('summarizer-system').value;
                const outputElem = document.getElementById('summarizer-output');
                if (!input) return;

                summarizeBtn.disabled = true;
                outputElem.textContent = '';
                outputElem.classList.add('typing-cursor');

                const generateText = httpsCallable(functions, 'ext-firebase-ai-logic-generateText');
                try {
                    const stream = await generateText({
                        prompt: input,
                        model: 'gemini-2.5-pro',
                        systemInstruction: system || undefined,
                        generationConfig: { stream: true }
                    });

                    for await (const chunk of stream.data) {
                        outputElem.textContent += chunk;
                    }
                    
                    addDoc(collection(db, "users", currentUser.uid, "trajectories"), {
                        action: "Summarized", title: input.substring(0, 30) + "...", timestamp: Date.now()
                    });

                } catch (error) {
                    console.error("Streaming Error:", error);
                    outputElem.textContent = "An error occurred during streaming. Please check the console for details.";
                } finally {
                    outputElem.classList.remove('typing-cursor');
                    summarizeBtn.disabled = false;
                }
            };
        }

        // --- AI TOOL: Researcher (Grounding with Google Search) ---
        function setupResearcherListeners() {
            const researchBtn = document.getElementById('research-btn');
            researchBtn.onclick = async () => {
                const input = document.getElementById('researcher-input').value;
                const outputElem = document.getElementById('researcher-output');
                if (!input) return;

                researchBtn.disabled = true;
                outputElem.innerHTML = `<div class="flex items-center gap-2 text-gray-400"><div class="w-5 h-5 border-2 border-white/50 border-t-white rounded-full animate-spin"></div>Searching and synthesizing...</div>`;

                const generateText = httpsCallable(functions, 'ext-firebase-ai-logic-generateText');
                try {
                    const result = await generateText({
                        prompt: `Using today's date of ${new Date().toDateString()}, answer the following question: ${input}`,
                        model: 'gemini-2.5-pro',
                        tools: { grounding: { googleSearch: {} } }
                    });
                    outputElem.textContent = result.data.text;
                     addDoc(collection(db, "users", currentUser.uid, "trajectories"), {
                        action: "Researched", title: input.substring(0, 30) + "...", timestamp: Date.now()
                    });
                } catch (e) {
                    outputElem.textContent = "An error occurred. The AI model may be unavailable or the request could not be processed.";
                    console.error("Research Error:", e);
                } finally {
                    researchBtn.disabled = false;
                }
            };
        }

        // --- AI TOOL: Ideas (Structured Output) ---
        function setupIdeasListeners() {
            const ideasBtn = document.getElementById('ideas-btn');
            ideasBtn.onclick = async () => {
                const input = document.getElementById('ideas-input').value;
                const outputElem = document.getElementById('ideas-output');
                if (!input) return;

                ideasBtn.disabled = true;
                outputElem.innerHTML = `<div class="flex items-center gap-2 text-gray-400"><div class="w-5 h-5 border-2 border-white/50 border-t-white rounded-full animate-spin"></div>Generating structured ideas...</div>`;
                
                const generateText = httpsCallable(functions, 'ext-firebase-ai-logic-generateText');
                try {
                    const result = await generateText({
                        prompt: `Generate 5 creative content ideas about ${input}.`,
                        model: 'gemini-2.5-pro',
                        generationConfig: {
                            responseMimeType: 'application/json',
                            responseSchema: {
                                type: 'array',
                                items: {
                                    type: 'object',
                                    properties: {
                                        title: { type: 'string' },
                                        description: { type: 'string' }
                                    },
                                    required: ['title', 'description']
                                }
                            }
                        }
                    });

                    const ideas = JSON.parse(result.data.text);
                    outputElem.innerHTML = '';
                    ideas.forEach(idea => {
                        outputElem.innerHTML += `<div class="bg-gray-800/50 p-3 rounded-lg">
                            <h4 class="font-semibold text-white">${idea.title}</h4>
                            <p class="text-sm text-gray-300">${idea.description}</p>
                        </div>`;
                    });
                    addDoc(collection(db, "users", currentUser.uid, "trajectories"), {
                        action: "Ideated", title: input.substring(0, 30) + "...", timestamp: Date.now()
                    });

                } catch (e) {
                     outputElem.innerHTML = `<p class="text-red-400">Error generating structured data. The model may have returned an invalid format. Please try again.</p>`;
                     console.error("Structured Output Error:", e);
                } finally {
                    ideasBtn.disabled = false;
                }
            };
        }
        
        // --- Global Nav Listeners ---
        document.querySelector('nav').addEventListener('click', (e) => {
            const navItem = e.target.closest('.nav-item');
            if (navItem) window.renderView(navItem.dataset.view);
        });

    </script>
</body>
</html>

